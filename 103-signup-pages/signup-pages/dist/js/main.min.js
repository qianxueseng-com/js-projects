"use strict";var $box=$(".slide-box"),$picture=$(".show-picture"),pictureCount=3,pid=0,flag=0,method=1,usePhoneNumber=1,useEmail=2,clickRange=8,nextPicture=function(){pid+=1,pid>pictureCount&&(pid=1),getPictureAndWord()},checkPictureSuccess=function(){$picture.hide(),$box.html('<img src="./dist/images/yes.png" />'),$("#boxhint").addClass("boxhint-success").text("验证成功"),$("#submit").addClass("submit-success")},getPictureAndWord=function(){var e,t;$("#boxhint").text("验证图片生成中..."),$("#verify").unbind("click"),0===pid&&(pid=Math.floor(100*Math.random())%pictureCount+1,$("#changepicture").on("click",nextPicture));var i="./dist/images/"+pid+".png";$("#verify").attr("src",i).on("click",function(i){var n=i.offsetX,o=i.offsetY;Math.abs(e-n)<=clickRange&&Math.abs(t-o)<=clickRange?(flag=1,$(this).unbind("click"),checkPictureSuccess()):($("#pictureHint").show().text("验证码点击错误，请重试!"),nextPicture())});var n="./data/picture/"+pid+".json";$.getJSON(n).done(function(i){var n=i[0].count,o=i[0].data,u=Math.floor(100*Math.random())%n+1,c=o[u].value;e=o[u].x,t=o[u].y,$("#boxhint").text("请点击图片中的 "+c+" 字")})},showPicture=function(){$("#boxhint").addClass("boxhint-show"),$box.html('<img src="./dist/images/no.png" />'),getPictureAndWord(),$picture.show()},boxinit=function(){$(document).unbind("mousemove"),$box.animate({left:"0px"}),$(".slide-show").animate({width:"0px"})},moveSlideBox=function(){$box.mousedown(function(e){var t=e.clientX-this.offsetLeft;$(document).mousemove(function(e){var i=e.clientX-t;0>i&&(i=0),i>272&&(i=272,$(document).unbind("mousemove").unbind("mouseup"),$box.unbind("mousedown"),showPicture()),$box.css("left",i+"px"),$(".slide-show").css("width",i+"px")})}),$(document).mouseup(function(){boxinit()})},checkPhoneNumber=function(e){if(""===e)return void $("#numberHint").show().text("请输入您的手机号码");var t=/^1[358]\d{9}$/;return t.test(e)?($("#numberHint").hide(),!0):($("#numberHint").show().text("手机号码格式不正确, 请重新输入"),!1)},checkEmail=function(e){if(""===e)return void $("#emailHint").show().text("请输入您的邮箱");var t=/^[._\-a-z0-9]+@[._\-a-z0-9]+(\.[._\-a-z0-9]+)+$/;return t.test(e)?($("#emailHint").hide(),!0):($("#emailHint").show().text("邮箱格式不正确, 请重新输入"),!1)};$(document).ready(function(){moveSlideBox(),$("#phoneNumber").on("blur",function(){var e=$("#phoneNumber").val();checkPhoneNumber(e)}),$("#submit").on("click",function(){if(flag){if(method===usePhoneNumber){var e=$("#phoneNumber").val();checkPhoneNumber(e)&&flag&&($("#numberHint").hide(),window.alert("第一步成功!"))}if(method===useEmail){var t=$("#email").val();checkEmail(t)&&flag&&($("#numberHint").hide(),window.alert("第一步成功!"))}}}),$("#regMethod").on("click",function(){method===usePhoneNumber?($("#show-phone").hide(),$("#show-email").show(),$("#phoneNumber").unbind("blur"),$("#email").on("blur",function(){var e=$("#email").val();checkEmail(e)}),$(this).text("个人用户可以使用手机号注册>>"),method=useEmail):method===useEmail&&($("#show-email").hide(),$("#show-phone").show(),$("#email").unbind("blur"),$("#phoneNumber").on("blur",function(){var e=$("#phoneNumber").val();checkPhoneNumber(e)}),$(this).text("需要通过邮箱注册"),method=usePhoneNumber)})});